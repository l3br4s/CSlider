export default class CSlider{constructor(t,i){if(this.options={arrowKeys:!0,autoplay:!1,autoplaySpeed:6e3,buttons:!0,buttonWrapperNext:t,buttonWrapperPrev:t,buttonTextNext:'<svg width="50" height="50" viewBox="0 0 100 100"><path fill="none" stroke="#000" stroke-width="8" d="M28.52 5l44.986 45.006L28.494 95"/></svg>',buttonTextPrev:'<svg width="50" height="50" viewBox="0 0 100 100"><path fill="none" stroke="#000" stroke-width="8" d="M71.48 95L26.494 49.994 71.506 5" /></svg>',fixedHeight:!0,focusOnClick:!0,pauseOnHover:!0,singleMode:!1,startPosition:1,swipe:!0,transitionSpeed:600,vertical:!1,wheelNavigation:!1,beforeChange(){},afterChange(){},afterTransition(){},afterResize(){},onReady(){}},Object.assign(this.options,i),!0===this.options.vertical&&!1!==i.wheelNavigation&&(this.options.wheelNavigation=!0),this.frame=document.querySelector(t),!this.frame)return void console.log("CSlider initialization error: Target element not found");if(this.frame.children.length<2)return void console.log("CSlider initialization error: Needs at least 2 slides");if(this.frame.classList.add("csl-frame"),this.frame.style.setProperty("--transition-speed",this.options.transitionSpeed+"ms"),this.frame.classList.add(!0===this.options.vertical?"csl-vertical":"csl-horizontal",!0===this.options.fixedHeight?"csl-height-fixed":"csl-height-auto",!0===this.options.swipe?"csl-swipe":"csl-no-swipe"),!0===this.options.swipe)for(var e of this.frame.querySelectorAll("img"))e.setAttribute("draggable","false");for(this.track=document.createElement("div"),this.track.classList.add("csl-track");this.frame.firstChild;)1==this.frame.firstChild.nodeType&&this.frame.firstChild.classList.add("csl-item"),this.track.appendChild(this.frame.firstChild);this.frame.appendChild(this.track),this.originalLength=this.frame.querySelectorAll(".csl-item").length;const r=()=>{this.slides=this.frame.querySelectorAll(".csl-item");var t,e=getComputedStyle(this.frame,null);!0===this.options.vertical?this.frameInnerSize=Math.round(this.frame.offsetHeight-parseInt(e.paddingTop)-parseInt(e.paddingBottom)-parseInt(e.borderTopWidth)-parseInt(e.borderBottomWidth)):this.frameInnerSize=Math.round(this.frame.offsetWidth-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth));for(t of this.slides){t.style.removeProperty("--csl-size");var s=!0===this.options.vertical?t.offsetHeight:t.offsetWidth;t.style.setProperty("--csl-size",`${!0===this.options.singleMode?this.frameInnerSize:s}px`)}this.track.classList.add("csl-sized"),requestAnimationFrame(()=>{this.trackSize=!0===this.options.vertical?this.track.offsetHeight:this.track.offsetWidth;var t=this.track.innerHTML;if(0<this.trackSize){for(this.oldTrackSize=this.trackSize;this.trackSize<4*this.frameInnerSize;)if(this.track.insertAdjacentHTML("beforeend",t),this.trackSize=!0===this.options.vertical?this.track.offsetHeight:this.track.offsetWidth,this.oldTrackSize===this.trackSize){console.log("Error duplicating slides: Track size did not change after insertion. Duplication aborted.");break}this.slides=this.frame.querySelectorAll(".csl-item")}n()})},s=(t,e)=>{0!==t.button||this.swiping||this.slideTo(e)},n=()=>{!0===this.options.focusOnClick&&(this.frame.classList.add("csl-focus"),this.slides.forEach((t,e)=>{t.removeEventListener("click",t=>s.bind(this,t,e)()),t.addEventListener("click",t=>s.bind(this,t,e)())}))},o=()=>{this.currentIndex=this.options.startPosition,this.currentSlide=this.slides[this.currentIndex],this.currentSlide.classList.add("csl-current")},a=()=>{this.currentOrder=[];for(let t=0;t<this.slides.length;t++)this.currentOrder.push(t)},l=(this.getCurrentOrder=()=>{let t=this.currentIndex-Math.floor((this.slides.length-1)/2),e=(t<0&&(t+=this.slides.length),0);for(;this.currentOrder[0]!=t&&!(++e>this.currentOrder.length);)this.currentOrder.push(this.currentOrder.shift());this.currentOrder.forEach((t,e)=>{this.slides[t].setAttribute("data-csl-order",e),this.slides[t].setAttribute("data-csl-relative",Math.floor(this.slides.length/-2)+e+1)})},()=>{var t,e;if(this.frame.classList.add("notrans"),r(),requestAnimationFrame(()=>{o(),a(),this.getCurrentOrder(),this.slideTo(this.options.startPosition,"init"),requestAnimationFrame(()=>{this.frame.classList.remove("notrans"),!0===this.options.autoplay&&this.autoplayStart()})}),!0===this.options.buttons&&((e=document.querySelector(this.options.buttonWrapperPrev))?((t=document.createElement("button")).classList.add("csl-button","csl-button-prev"),t.setAttribute("aria-label","Previous slide"),!0===this.options.arrowKeys&&t.setAttribute("tabindex","-1"),t.innerHTML=this.options.buttonTextPrev,e.appendChild(t),t.addEventListener("click",()=>{this.prev()})):console.warn("Previous button wrapper element not found. Button will not be created."),(e=document.querySelector(this.options.buttonWrapperNext))?((t=document.createElement("button")).classList.add("csl-button","csl-button-next"),t.setAttribute("aria-label","Next slide"),!0===this.options.arrowKeys&&t.setAttribute("tabindex","-1"),t.innerHTML=this.options.buttonTextNext,e.appendChild(t),t.addEventListener("click",()=>{this.next()})):console.warn("Next button wrapper element not found. Button will not be created.")),!0===this.options.arrowKeys){this.frame.setAttribute("tabindex","0");let e=!1;this.frame.addEventListener("keydown",t=>{e||t.key!==(!0===i.vertical?"ArrowUp":"ArrowLeft")?e||t.key!==(!0===i.vertical?"ArrowDown":"ArrowRight")||(this.next(),e=!0):(this.prev(),e=!0),window.onkeyup=()=>{e=!1}})}if(!0===this.options.wheelNavigation){let e=!1;this.frame.addEventListener("wheel",t=>{t.preventDefault(),e||(e=!0,(this.options.vertical?t.deltaY:t.deltaX)<0?this.prev():this.next(),setTimeout(()=>{e=!1},100))})}let s;window.addEventListener("resize",()=>{clearTimeout(s),s=setTimeout(()=>{this.frame.classList.add("notrans"),r(),requestAnimationFrame(()=>{a(),this.getCurrentOrder(),this.slideTo(this.currentIndex,"resize"),requestAnimationFrame(()=>{n(),this.frame.classList.remove("notrans")})})},100)})});"complete"===document.readyState?l():window.addEventListener("load",()=>{l()}),!0===this.options.swipe&&(this.track.addEventListener("mousedown",(t=(d="mouse")=>{const c={start:"mouse"===d?"mousedown":"touchstart",move:"mouse"===d?"mousemove":"touchmove",end:"mouse"===d?"mouseup":"touchend",cancel:"mouse"===d?"mouseleave":"touchcancel"};return t=>{if("mouse"!==d||0===t.button){!0===this.options.autoplay&&clearTimeout(this.autoPlayTimeout);t="mouse"===d?{x:t.clientX,y:t.clientY}:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY};const a=[...this.slides];this.frame.classList.add("notrans");let n=!0===this.options.vertical?t.y:t.x,o=n;const l=t=>{var e,s="mouse"===d?{x:t.clientX,y:t.clientY}:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY};let i;for(e of a){var r=parseInt(window.getComputedStyle(e).getPropertyValue("--csl-translate"));e.style.setProperty("--csl-translate",r+(!0===this.options.vertical?s.y:s.x)-n+"px")}i=!0,this.swiping=!0,n=!0===this.options.vertical?s.y:s.x,setTimeout(()=>{},10)},h=t=>{t="mouse"===d?{x:t.clientX,y:t.clientY}:{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY},t=!0===this.options.vertical?t.y:t.x;if(this.frame.classList.remove("notrans"),document.removeEventListener("mouseup",h),Math.abs(o-t)<30)this.slideTo(this.currentIndex);else{var e,s=this.frame.getBoundingClientRect(),i=!0===this.options.vertical?s.y+s.height/2:s.x+s.width/2,r=[];for(e of a){var n=e.getBoundingClientRect(),n=!0===this.options.vertical?n.y+n.height/2:n.x+n.width/2;r.push(Math.abs(i-n))}s=r.indexOf(Math.min(...r)),s=a.indexOf(a[s]),this.currentIndex===s?0<o-t?this.next():this.prev():this.slideTo(s,"swipe"),setTimeout(()=>{this.swiping=!1},10)}this.track?.removeEventListener(c.move,l),document.removeEventListener(c.end,h),this.track?.removeEventListener(c.cancel,h)};this.track.addEventListener(c.move,l),document.addEventListener(c.end,h),this.track.addEventListener(c.cancel,h)}}})("mouse")),this.track.addEventListener("touchstart",t("touch"))),!0===this.options.pauseOnHover&&(this.frame.addEventListener("mouseenter",()=>{this.autoplayPaused=!0}),this.frame.addEventListener("mouseleave",()=>{this.autoplayPaused=!1}))}slideTo(s,t){if(this.slides[s]){!0===this.options.autoplay&&(clearTimeout(this.autoPlayTimeout),this.autoPlayTimeout=setTimeout(()=>{clearTimeout(this.autoPlayTimeout),this.autoplayPaused?this.frame.addEventListener("mouseleave",()=>{this.next()},{once:!0}):this.next()},Math.max(this.options.autoplaySpeed,this.options.transitionSpeed))),t||this.options.beforeChange();var e=this.currentOrder.indexOf(this.currentIndex)-this.currentOrder.indexOf(s);if(e<0)for(let t=0;t<Math.abs(e);t++)this.slides[this.currentOrder[t]].style.setProperty("--transition-speed","0ms");else for(let t=this.currentOrder.length-1;t>=this.currentOrder.length-e;t--)this.slides[this.currentOrder[t]].style.setProperty("--transition-speed","0ms");this.currentSlide=this.slides[s];const n=!0===this.options.vertical?this.currentSlide.offsetTop-this.frameInnerSize/2+this.currentSlide.offsetHeight/2:this.currentSlide.offsetLeft-this.frameInnerSize/2+this.currentSlide.offsetWidth/2,o=s+Math.floor(this.slides.length/2),a=s+1-Math.ceil(this.slides.length/2);this.currentSlide.addEventListener("transitionend",()=>{this.options.afterTransition()},{once:!0}),this.slides.forEach((t,e)=>{t.classList.remove("csl-next","csl-prev","csl-adjacent"),a>e?(t.style.setProperty("--csl-translate",-1*(n-this.trackSize)+"px"),t.classList.add("csl-swapped-ltr")):o<e?(t.style.setProperty("--csl-translate",-1*(n+this.trackSize)+"px"),t.classList.add("csl-swapped-rtl")):(t.style.setProperty("--csl-translate",-1*n+"px"),t.classList.remove("csl-swapped-rtl"),t.classList.remove("csl-swapped-ltr")),s<e&&e<=o||e<a?(t.classList.remove("csl-before"),t.classList.add("csl-after")):(e<s&&e>=a||e>o)&&(t.classList.remove("csl-after"),t.classList.add("csl-before")),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.style.removeProperty("--transition-speed")})})});var i=s+1>=this.slides.length?0:s+1,r=s-1<0?this.slides.length-1:s-1;this.slides[i].classList.add("csl-next","csl-adjacent"),this.slides[r].classList.add("csl-prev","csl-adjacent"),this.slides[this.currentIndex].classList.remove("csl-current"),this.currentSlide.classList.remove("csl-after","csl-before"),this.currentSlide.classList.add("csl-current"),this.currentIndex=s,this.currentOriginalIndex=s%this.originalLength,this.getCurrentOrder(),t||this.options.afterChange(),"init"===t&&(console.log("CSlider ready!"),this.options.onReady()),"resize"===t&&this.options.afterResize()}}prev(){this.slideTo(this.currentIndex-1<0?this.slides.length-1:this.currentIndex-1)}next(){this.slideTo(this.currentIndex+1>this.slides.length-1?0:this.currentIndex+1)}autoplayStart(){this.options.autoplay=!0,this.slideTo(this.currentIndex)}autoplayStop(){this.options.autoplay=!1,clearTimeout(this.autoPlayTimeout)}}